<!DOCTYPE HTML PUBliC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3c.org/TR/1999/REC-html401-19991224/loose.dtd">
<HTML xmlns="http://www.w3.org/1999/xhtml">
<HEAD>
<TITLE>目录</TITLE>
<META http-equiv=Content-Type content="text/html; charset=utf-8">
<script src="../static_bootstrap/js/jquery-1.9.1.min.js"></script>
<script src="../static_bootstrap/js/jquery-migrate-1.0.0.min.js"></script>
<script src="../static_bootstrap/js/bootstrap-treeview.js"></script>
<link href="../static_bootstrap/css/bootstrap-treeview.css" type=text/css rel=stylesheet>
<link href="../static_bootstrap/css/bootstrap-3.3.5.min.css" rel="stylesheet">
<link href="../static_bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet">
<link id="base-style-responsive" href="../static_bootstrap/css/style-responsive.css" rel="stylesheet">
</HEAD>
<BODY>
	<div class="container" style="width: 100%;">
		<div class="row">
			<div class="form-group" style="width:400px;margin-left:15px;">
		      <label >选择文件</label>
		      <select id="filePathSelect" class="form-control">
		       	 <#list folderList as folder>
		          <option value="${folder.folderId!}"  <#if (folderPath??&&folderPath==folder.folderPath)> selected="selected"</#if>>${folder.folderPath!}</option>
		          </#list>
		     </select>
		    </div>
		</div>
		
		 <form id="child_form" actoin="child.htm" method="post">
		 <input id="folderPath_form" name="folderPath" type="hidden" value=""/>
		 </form>   
		
	    <#if folderChild??>
		<div class="row">
			<div id="container" class="col-md-2">
				<div id="treeview1" class="treeview">
			  <ul id="left_side" class="list-group">
			    <li class="list-group-item active">文件夹</li>
			    
			    <#if (folderChild?size>0)>
				    <#list folderChild as file>	  
				      <#if (file.isDirectory()!)>
				            <#assign absolutePath =file.absolutePath?replace('\\','\\\\' )]	
				            <li onclick="getChild('${absolutePath!}')" class="list-group-item node-treeview1" data-nodeid="0" style="">
						      ${file.name?trim}
						    </li>
				      </#if> 
				    </#list> 
			    
			    <#else>
			        <li class="list-group-item node-treeview1" data-nodeid="0">没有更多</li>
			         <li class="list-group-item node-treeview1" data-nodeid="0"><button type="button" class="btn btn-primary btn-xs" onclick= "history.go(-1)">返回上级 </button></li>
			    </#if>
			     
			  </ul>
			</div>
			</div>
			<div div class="col-md-6">
				<table class="table table-bordered">
							  <thead>
								  <tr class="active">
									  <th>文件名</th>
									  <th>修改日期</th>
									  <th>大小</th>                                          
									  <th>状态</th>
									  <th>操作</th>
								  </tr>
							  </thead>   
							  <tbody>
							  
							  <#if (folderChild?size<1)>
							     <tr>
									<td colspan="10">
									 该目录下没有文件.
									</td>
								</tr>
							  <#else>
							  
								<#list fileTaskList as task>
									<#if !(folderChild[task_index].isDirectory())>
										<tr>
										   <td style= "cursor:pointer; " onclick="showTaskDetail(${task_index})" >${folderChild[task_index].name}</td>
											<td>
											 ${(folderChild[task_index].lastModified())?number_to_datetime?string('yyyy-MM-dd HH:mm')}
											</td>	
											<td>
											<#assign size =folderChild[task_index].length()?number]		
											 <#if ((size/1073741824)>1)>
											  ${(size/1073741824)?string("0.##")} G		
											 <#elseif ((size/1048576)>1)>
											  ${(size/1048576)?string("0.##")} M
											 <#elseif ((size/1024)>1)>
											  ${(size/1024)?string("0.##")} KB		
											 <#else>
											   ${size?string("0.##")} B	
											 </#if>		 
											</td>	
											
										   <#if task.filePath??>
										      <#if task.taskStatus==0>
											<td> <span class="label label-default">未启动</span></td>
											<td> 执行</td>
											  <#elseif task.taskStatus==1>
											 <td><span class="label label-info">执行中</span></td>
											 <td> </td>
											  <#elseif task.taskStatus==2>
											 <td><span class="label label-success">已入库</span></td>
											  <td><a  name="previewClick" data-path="${folderChild[task_index].path!}" href="#">重新导入</a> </td>
											  <#elseif task.taskStatus==-2>
											<td><span class="label label-danger">异  常</span></td>
											<td>重新导入 </td>
											 </#if>		 
										   <#else>
										     <td> <span class="label label-warning">未添加</span></td>
										     <td><a name="previewClick" data-path="${folderChild[task_index].path!}" href="#">添加到任务</a> </td>
										   </#if>	
											
											
										</tr> 	
									</#if>     		
									</#list>
								 </#if>                           
							  </tbody>
						 </table>  
<#if (page??&&page.totalPage>1)>
<nav style="margin: 0 auto;text-align: center; width: 100%;">
  <ul class="pagination">
   <li>
      <a href="list.htm?status=${status!}&pageNo=1&pageSize=${page.pageSize}" aria-label="第一页">
        <span aria-hidden="true">&laquo;</span>
      </a>
    </li>
  <#list 1..page.totalPage as pageCur>
	<#if pageCur!=0>
	  <#if pageCur==page.pageNo>
	  	<li class="active">
	  <#else>
	  	<li>
	  </#if>
	  <a href="child.htm?pageNo=${pageCur}&pageSize=${page.pageSize}">${pageCur} <span class="sr-only">(current)</span></a>
	</#if>
  </#list>
   <li>
      <a href="child.htm?pageNo=${page.totalPage}&pageSize=${page.pageSize}" aria-label="最后一页">
        <span aria-hidden="true">&raquo;</span>
      </a>
    </li>
  </ul>
</nav>
</#if>
				
			             </div>
			<div class="col-md-4" id="right_side" style="display:none;">
			 <#list fileTaskList as task>
         		<#if !(folderChild[task_index].isDirectory())>
					<ul class="list-group" id="detailInfo_${task_index}" <#if task_index!=1> style="display:none;"</#if>>
					  <li class="list-group-item active">文件信息</li>
					  <#if task.filePath??>
						  <li class="list-group-item">状态：
							    <#if task.taskStatus==0>
								    <span class="label label-default">未启动</span>
								<#elseif task.taskStatus==1>
							    	<span class="label label-info">执行中</span>									    
							    <#elseif task.taskStatus==-2>
							        <span class="label label-danger">异  常</span>
							    <#elseif task.taskStatus==2>
							        <span class="label label-success">已入库</span>
							    </#if>	
						  </li> 
						  <li class="list-group-item">表名： ${task.tableName!}</li>
						  <li href="#" class="list-group-item">记录数：${task.runNum!} &nbsp;&nbsp;&nbsp;&nbsp;<button onclick="showValues('${task.uid!}','${task.tableNameAlias!}')" class="btn btn-primary  btn-xs" type="button">浏览</button></li>
						  <li class="list-group-item">入库时间：${task.startDate!}</li>
						  <li class="list-group-item">完成时间：${task.endDate!}</li>
						  <li class="list-group-item">来源:${task.origin!}</li>
						  <li class="list-group-item">源文件名称:${task.filePath!}</li>
						  <li class="list-group-item">数据时间：${task.dataTime!}</li>
						  <li class="list-group-item">标签组：${task.tags!}</li>
					  <#else>
					      <li class="list-group-item">源文件名称:${folderChild[task_index].name}</li>
					      <li class="list-group-item">修改时间：${(folderChild[task_index].lastModified())?number_to_datetime?string('yyyy-MM-dd HH:mm:ss')}</li>
						  <li class="list-group-item"><a name="previewClick" data-path="${folderChild[task_index].path!}" href="#" style="color:#FFF;"><span class="label label-warning">未添加到计划任务中</span></a></li>
					    </#if>
					</ul>
				</#if>  
             </#list>
			</div>
		</div>
	</div>
</#if>
</BODY>
<script src="../static_bootstrap/js/ie10-viewport-bug-workaround.js"></script>


<form id="previewForm" action="../file/preview.htm" method="post">
<input type="hidden" name="filePath" id="filePath" value=""/>
</form>

<form id="showValues" action="../mongo/tableValues.htm" method="post">
<input type="hidden" name="pageSize" id="pageSize" value="2"/>
<input type="hidden" name="uid" id="uid" value=""/>
<input type="hidden" name="tableNameAlias" id="tableNameAlias" value=""/>
</form>

<script>

$('#filePathSelect').change(function(){ 
	window.location.href="child.htm?folderId="+$(this).val();
}) 
	
function getFolderChild(){	
	//this.options[this.options.selectedIndex].value
	

}


function showTaskDetail(id){	
	$("ul[id^='detailInfo']").hide();
	$("#right_side").show();
	$("#detailInfo_"+id).show(300);
}

function getChild(folderPath){
	$("#folderPath_form").val(folderPath);
	$("#child_form").submit();
}

function getChild2(folderPath){	
	 $.ajax(  
             {  
                 url:'child.htm', 
                 type:"post",  
                 async:true,  
                 data:{'folderPath':folderPath,'append':true},  
                 dataType:"html",  
                 timeout:"100000",  
                 error:function(){alert("获取文件失败");},  
                 success:function(data)  
                 {  
                	$("#content").html(data);  
                 }  
             }  
         );  

}


function getFileTaskInfo(filePath){	
	 $.ajax(  
             {  
                 url:'../file/fileTaskInfo.htm', 
                 type:"post",  
                 async:true,  
                 data:{'filePath':filePath},  
                 dataType:"html",  
                 timeout:"100000",  
                 error:function(){alert("获取文件失败");},  
                 success:function(data)  
                 {  
                	$("#content").html(data);  
                 }  
             }  
         );  

}

$("a[name='previewClick'").click(function(){
	var path= encodeURIComponent($(this).attr("data-path"));
	$("#filePath").val(path);
	$("#previewForm").submit();
});


function showValues(uid,tableNameAlias) {     	    
	$("#uid").val(uid);
	$("#tableNameAlias").val(tableNameAlias);
	$("#showValues").submit();

}

</script>	   
		
</HTML>