<!DOCTYPE HTML PUBliC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3c.org/TR/1999/REC-html401-19991224/loose.dtd">
<HTML xmlns="http://www.w3.org/1999/xhtml">
<HEAD>
<TITLE>Solr入库任务列表</TITLE>
<META http-equiv=Content-Type content="text/html; charset=utf-8">
<script src="../static_bootstrap/js/jquery-1.9.1.min.js"></script>
<script src="../static_bootstrap/js/jquery-migrate-1.0.0.min.js"></script>
<link href="../static_bootstrap/css/bootstrap-3.3.5.min.css" rel="stylesheet">
<link href="../static_bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet">
<link id="base-style-responsive" href="../static_bootstrap/css/style-responsive.css" rel="stylesheet">
<link href="../static_bootstrap/css/my.css" type=text/css rel=stylesheet>
</HEAD>
<BODY>
	<div class="container" style="width: 100%;">
	    
	    <#if status??&&(status==888 || status==0 || status==1 || status==-2)>
	    <script language=javascript>setInterval("window.location.reload()",5000)</script>
		<div class="row">
			<h4 style="font-weight: bold;margin-top: 0px;">当前任务总数:&nbsp;&nbsp;${list?size}</h4>
			<div class="progress">
				<div class="label-info label-progress" style="width: 33%;" onclick="showList(1)">
				执行中4/30%</div>
				<div class="label-danger label-progress" style="width: 33%;" onclick="showList(-2)">失败2/15%</div>
				<div class="label-default label-progress" style="width: 34%;"  onclick="showList(0)">未启动2/15%</div>
			</div>
		</div>
		</#if>
		<div class="row">
				<table class="table table-bordered" style="width:99%;margin-left:5px;">
							  <thead>
								  <tr class="active">
									  <th>序号</th>
									  <th>任务名称</th>
									  <th>创建者</th>
									  <th>状态</th>
									  <th>计划时间</th>
									  <th>启动时间</th>
									  <th>执行时长</th>
									  <th>进度/数据条目</th>
									  <th>数据总条目</th>
									 
								  </tr>
							  </thead>   
							  <tbody>
							  
							  <#if (list?size>0)>
							  <#list list as task>
								<tr>
									<td>${task_index+1!}</td>
									<td class="center">${task.tableName!}-${task.origin!}</td>
									<td class="center">${task.createUser!}</td>  
									<td class="center">
									
									<#if (task.totalCount??&&task.runNum??&&task.totalCount!=task.runNum)>
									     <span class="label label-danger">异常</span> 
									<#else>
									     <#if task.taskStatus==0>
										    <span onclick="showList(0)" class="label label-default">未启动</span>
										 <#elseif task.taskStatus==1>
									    	<span onclick="showList(1)" class="label label-info">执行中</span>									    
									    <#elseif task.taskStatus==-2>
					 				        <span onclick="showList(-2)" class="label label-danger">失败</span>
									    <#elseif task.taskStatus==2>
									        <span onclick="showList(2)" class="label label-success">已完成</span>
									    <#elseif task.taskStatus==-100>
									        <span onclick="showList(-100)" class="label label-default">初始化</span>
									    <#elseif task.taskStatus==-200>
									        <span onclick="showList(-200)" class="label label-danger">异常</span>    
									    <#else>
									         <span class="label label-default">未知错误</span>
									    </#if>   
									</#if>
									
									    
									</td>  
									<td class="center">${task.runTime!}</td>
									<td class="center">${task.startDate!}</td>
									<td class="center">${task.timeUse!}毫秒									
									</td> 
									<td class="center">
									<#if (task.totalCount??&&task.totalCount!=0)&&(task.runNum??&&task.runNum>0)>
	   
									   <#assign percent = ((task.runNum!/task.totalCount!)*100)?string("0.##")>
									   <#if percent=="100">
									    <font color="green">${percent!}%</font> 
									   <#else>
									     <font color="#EF0F1A">${percent!}%</font> 
									   </#if>		
								   <#else>
								   		0%
								   </#if>
									   /${task.runNum!}</td>
									<td class="center">${task.totalCount!}</td> 
									                                  
								</tr>
								</#list>
								<#else>
								  <tr>
									<td colspan="10">
									            当前队列中，没有执行的任务
									</td>
								  </tr>
								</#if>
							  </tbody>
						 </table>  
<#if (page.totalPage>1)>
<nav style="margin: 0 auto;text-align: center; width: 100%;">
  <ul class="pagination">
   <li>
      <a href="list.htm?status=${status!}&pageNo=1&pageSize=${page.pageSize}" aria-label="第一页">
        <span aria-hidden="true">&laquo;</span>
      </a>
    </li>
  <#list 1..page.totalPage as pageCur>
	<#if pageCur!=0>
	  <#if pageCur==page.pageNo>
	  	<li class="active">
	  <#else>
	  	<li>
	  </#if>
	  <a href="list.htm?status=${status!}&pageNo=${pageCur}&pageSize=${page.pageSize}">${pageCur} <span class="sr-only">(current)</span></a>
	</#if>
  </#list>
   <li>
      <a href="list.htm?status=${status!}&pageNo=${page.totalPage}&pageSize=${page.pageSize}" aria-label="最后一页">
        <span aria-hidden="true">&raquo;</span>
      </a>
    </li>
  </ul>
  <#if status??&&(status==888 || status==0 || status==1 || status==-2)>
	    <button type="button" onclick="showList()" class="btn btn-primary" style="float:left;margin-top: 15px;">查看入库任务日志</button>
  </#if>
</nav>
<#else>
    <#if status??&&(status==888 || status==0 || status==1 || status==-2)>
	    <button type="button" onclick="showList()" class="btn btn-primary" style="float:left;margin-top: 15px;">查看入库任务日志</button>
	</#if>
</#if>
 
	</div>
</div>

</BODY>
<script src="../static_bootstrap/js/ie10-viewport-bug-workaround.js"></script>
<script>
function showList(status){
	if (typeof status == "undefined")
	{
		window.location.href="list.htm?pageSize=${page.pageSize}";
	}else{
		window.location.href="list.htm?status="+status+"&pageSize=${page.pageSize}";
	}
 	 
}

</script>
		
</HTML>